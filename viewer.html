<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">PDF Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f7f7f7;
        }
        .main-content {
            max-width: 900px;
            margin: 24px auto;
            padding: 16px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .pdf-container {
            width: 100%;
            height: 70vh;
            margin: 0 auto;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 4px;
        }
        @media (max-width: 600px) {
            .main-content {
                max-width: 98vw;
                margin: 8px auto;
                padding: 4px;
            }
            .pdf-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="main-content">
        <h1 id="pdf-title">PDF Viewer</h1>
        <div class="pdf-container">
            <iframe id="pdf-iframe" src="" allowfullscreen></iframe>
        </div>
        <div id="loading-message" style="display:none;">
            <em>Loading... If this takes more than 30 seconds, please try <span id="download-link-text"></span> instead.</em>
        </div>
        <div style="margin-top:32px;">
            <a href="javascript:history.back()" style="color:#555; text-decoration:underline; font-size:1em;">&larr; Go Back</a>
        </div>
    </div>
    <script>
        // Robust error handling for embedUrl using iframe events and timeout
        const urlParams = new URLSearchParams(window.location.search);
        const pdfTitle = urlParams.get('title') || 'PDF Document';
        const embedUrl = urlParams.get('url');
        const downloadUrl = urlParams.get('download');

        // Update page title and heading
        document.getElementById('page-title').textContent = pdfTitle;
        document.getElementById('pdf-title').textContent = pdfTitle;

        // Set iframe source or show error
        const iframeContainer = document.querySelector('.pdf-container');
        const iframeElement = document.getElementById('pdf-iframe');
        const loadingMessage = document.getElementById('loading-message');
        const downloadLinkText = document.getElementById('download-link-text');

        if (!embedUrl || embedUrl.trim() === '') {
            iframeContainer.innerHTML = '<p style="color:red;">[not available]</p>';
            loadingMessage.style.display = 'none';
        } else {
            // Show loading message and keep it visible
            loadingMessage.style.display = 'block';
            
            // Set download link text based on downloadUrl availability
            if (downloadUrl && downloadUrl.trim() !== '') {
                downloadLinkText.innerHTML = `<a href="${downloadUrl}" target="_blank" style="font-size:1em; text-decoration:underline;">direct download</a>`;
            } else {
                downloadLinkText.textContent = '[not available]';
            }
            
            // Listen for iframe errors
            iframeElement.addEventListener('error', () => {
                loadingMessage.style.display = 'none';
                iframeContainer.innerHTML = '<p style="color:red;">Error: Failed to load the resource. The URL may be invalid or the file may not exist.</p>';
            });

            // Set the iframe source to start loading
            iframeElement.src = embedUrl;
        }
    </script>
</body>
</html>
